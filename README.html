<!DOCTYPE HTML>
<html>
   <head>
      <meta http-equiv="content-Type" content="text/html; charset=utf-8" />
      <title>README</title>
      <style type="text/css">
         body {
            margin: 0px 8% 4em 8%;
            padding-top: 18pt;
            background-color:white;
            color:black;
            text-align:justify;
         }
         .menu, h1 {
            color:#990000;
         }
         h1 a {
            color:#000;
         }
         .menu a {
            color:#000;
            text-decoration:none;
            border-bottom:1px dotted black;
         }
         li {
            line-height:2em;
         }
         .envadrouille {
            font-style:italic;
         }
         .title {
            font-family:Georgia, "Times New Roman", Times, serif;
            line-height:1.2;
            font-size:4.4em;
            text-align:center;
         }
         .language { 
         }


         /* CSS Tree menu styles */
         ol.tree
         {
           padding: 0 0 0 30px;
         }
         ol.tree li 
         { 
           list-style: none;
         }
         li.file
         {
           margin-left: -1px !important;
           background: url(css/document.png) 0 7px no-repeat;
           color: #000;
           padding-left: 21px;
           display: block;
           position:relative;
         }
         li.file a
         {
           text-decoration: none;
         }
         ol.tree li label
         {
           background: url(css/folder-horizontal.png) 15px 7px no-repeat;
           cursor: pointer;
           display: block;
           padding-left: 37px;
           position:relative;
         }
         ol.tree .descr {
            position:absolute;
            left:180px;
            color:#444;
            font-style:italic;
            font-size:12px;
         }

         .toolbar {
           display:none!important;
         }
       </style>
       <script type="text/javascript">
       function hide(div) {
          var d = document.getElementById(div);
          d.style.display = 'none';
          return false;
       }

       function showHide(div) {
          var d = document.getElementById(div);
          if(d.style.display == 'none')
            d.style.display = 'block';
          else
            d.style.display = 'none';
          return false;
       }
       </script>
       <script type="text/javascript" src="js/shCore.js"></script>
       <script type="text/javascript" src="js/shBrushJScript.js"></script>
       <script type="text/javascript" src="js/shBrushCss.js"></script>
       <script type="text/javascript" src="js/shBrushPhp.js"></script>
       <script type="text/javascript" src="js/shBrushXml.js"></script>
       <link href="css/shCore.css" rel="stylesheet" type="text/css" />
       <link href="css/shThemeDefault.css" rel="stylesheet" type="text/css" />
   </head>
   <body>
      <div class="title">EnVadrouille - Developers</div>


      <div id="en" class="language">
         <ul class="menu">
            <li>0. <a href="#en-Gen">General information about EnVadrouille</a></li>
            <ul>
              <li>0.1 <a href="#en-Gen-1">Available scripts</a></li>
              <li>0.2 <a href="#en-Gen-2">Paths, thumbnails, jsons</a></li>
            </ul>
            <li>1. <a href="#en-Theme">Create a theme</a></li>
            <li>1. <a href="#en-Plugin">Create a plugin</a></li>
            <ul class="menu">
              <li>2.0 <a href="#en-Plugin-0">Philosophy</a></li>
              <li>2.1 <a href="#en-Plugin-1">Administration plugin - Hello world</a></li>
              <li>2.2 <a href="#en-Plugin-2">Gallery plugin - Hello World</a></li>
              <li>2.3 <a href="#en-Plugin-3">Available classes and hacks</a></li>
              <ul>
                  <li>2.2.1 <a href="en-Plugin-3-1">Files manipulation</a></li>
                  <li>2.2.2 <a href="en-Plugin-3-2">Use multiple JS files in an administration plugin</a></li>
                  <li>2.2.3 <a href="en-Plugin-3-3">Translation in the administration</a></li>
                  <li>2.2.4 <a href="en-Plugin-3-4">Information popups in the administration</a></li>
              </ul>
              <li>2.4 <a href="#en-Plugin-4">Complete example</a></li>
            </ul>
         </ul>

         <h1>0. <a name="en-Gen">General information about EnVadrouille</a></h1>
         Here are some general information about EnVadrouille that might be useful to create themes and plugins.

         <h2>0.1 <a name="en-Gen-1">Available scripts</a></h2>
         In the gallery, you may safely assume that the following API will be automatically loaded:
         <ul>
            <li>jQuery v1.7</li>
            <li>jQuery template plugin, see <a href="https://github.com/jquery/jquery-tmpl">https://github.com/jquery/jquery-tmpl</a></li>
            <li>jQuery color animation plugin (you can animate background-color, using jQuery animate)</li>
            <li>jQuery url plugin (you can use $.url)</li>
            <li>jQuery cookie plugin (you can use $.cookie)</li>
            <li>jQuery doTimeout plugin, see <a href="http://benalman.com/projects/jquery-dotimeout-plugin/">http://benalman.com/projects/jquery-dotimeout-plugin/</a></li>
            <li>jQuery ColorBox v1.3.34 (slideshow plugin), see <a href="http://www.jacklmoore.com/colorbox">http://www.jacklmoore.com/colorbox</a></li>
            <li>A custom script loader named $script, see below.</li>
         </ul>

         <br/>
         To know when an API has been loaded, use the $script API as follows:
         <pre class="brush: js;">
$script("http://domain/foo.js", "foo", function() {
   // code that will be executed once foo.js has been loaded
   // this function is optional, you can call $script with only 2 arguments
});
$script.loaded(['foo', 'jquery', 'colorbox'], function() {
   // code that will get executed once foo, jquery and colorbox have been loaded
});
         </pre>

         <br/>

         <h2>0.2 <a name="en-Gen-2">Paths, thumbnails, jsons</a></h2>
         <table>
           <tr>
             <td valign="top" width="1000px" style="padding-right:20px;text-align:justify">
               <ol class="tree">
                 <li>
                   <label for="admin">admin</label> 
                   <ol>
                    <li>
                       <label for="common">common <span class="descr">general libraries, see <a href="#en-Plugin-3">section 2.3</a></span></label> 
                       <label for="pages">pages <span class="descr">plugins, see <a href="#en-Plugin">section 2</a></label> 
                    </li>
                   </ol>

                  <label for="cache">cache</label> 
                   <ol>
                    <li>
                       <label for="json">json</label> 
                       <ol>
                          <li>
                             <li class="file">cache.json <span class="descr">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json containing the metadata of the index, see just bellow</span></li>
                             <label for="directoryX">directoryX</label> 
                             <ol>
                              <li class="file">cache.json <span class="descr">json containing the metadata of directoryX, see just bellow</span></li>
                             </ol>
                          </li>
                       </ol>
                       <label for="thumbs">thumbs</label> 
                       <ol>
                          <li>
                             <label for="admin">directoryX</label> 
                             <ol>
                              <li class="file">picX_r.jpg <span class="descr">main thumbnail for picX; size configured in the admin</span></li>
                              <li class="file">picX_b.jpg <span class="descr">big thumbnail, width=350px, height depends on the original height</span></li>
                              <li class="file">picX_c.jpg <span class="descr">crop thumbnail, 200px*150px</span></li>
                              <li class="file">picX_m.jpg <span class="descr">small thumbnail, width=150px, height depends on the original height</span></li>
                             </ol>
                          </li>
                       </ol>
                    </li>
                   </ol>

                  <label for="pics">pics</label> 
                  <ol>
                        <li>
                           <label for="admin">directoryX</label> 
                           <ol>
                            <label for="admin">subdirectoryX</label> 
                            <li class="file">mygpx.gpx</li>
                            <li class="file">picX.jpg</li>
                            <li class="file">vid.ogv</li>
                            <li class="file">vid.mp4 <span class="descr">vid.ogv and vid.mp4 are the same video with different codecs</span></li>
                            <li class="file">vid2.ogv</li>
                           </ol>
                        </li>
                     </ol>

                  <label for="themes">themes</label> 
                  <ol>
                        <li>
                           <label for="themeX">themeX</label> 
                        </li>
                     </ol>

                  <label for="themes">scripts</label> 
                 </li>
               </ol>
             </td>
             <td>
             </td>
           </tr>
         </table>

<br/>
<a name="json-div-a"></a><b>Description of cache.json files:</b>  <a href="#" onclick="return showHide('json-div');">click here</a>
        <div id="json-div" style="display:none;">
          <pre class="brush: js;">
// See bellow for real examples
// All variables named foo* may be undefined
{
  dirs*:[                                                              // list of subdirectories
    {
       ID:&lt;display order&gt;,                                             // e.g., 0 
       url:&lt;name of the directory&gt;,                                    // e.g., 'subdirdirX' 
       thumbs:[&lt;name of thumbs&gt;],                                      // e.g., ['index_m.jpg', '0_m.jpg'] 
                                                                       // You can replace _m with _c or _b in your code 
                                                                       // to access thumbnails of different size 
       descr:&lt;description&gt;,                                            // e.g., 'foobar' 
       starred:&lt;true if the directory should be highlighted&gt;,  
    }
  ],
  pics*:[                                                              // list of pictures
    {
       url:&lt;name of the picture&gt;,                                      // e.g., foo.jpg
       fullpath*:&lt;path of the picture (if undefined, path=path of the gallery)&gt; 
       original:true if the original picture is bigger than the _r thumbnail
    }
  ],
  vids*:[                                                              // list of videos
    {
      url:[&lt;nameS of the video&gt;]                                       // e.g., [foo.mp4, foo.ogv]
    }                                                                  // /!\ videos with same basename but different
                                                                       // extensions are regrouped!
  ],
  gpx*:&lt;PATH of the gpx file of the gallery, '' or undefined when no gpx is available&gt;,
  gpxtype*:&lt;maps type, "terrain", "satellite" or "roadmap"&gt;
  descr*:&lt;description of the gallery&gt;
}

//E.g., for the files presented before
//    /cache/json/cache.json, the cache.json of the index of the gallery:
{
  "dirs":[{"ID":0, "url":"directoryX", "thumbs":['picX_m.jpg'], "descr":"dir descr", starred:false}],
}

//    /cache/json/directoryX/cache.json, the cache.json of directoryX:
{
  "dirs":[{"ID":0, "url":"subdirectoryX", "thumbs":[], "descr":"subdir descr", starred:false}],
  "pics":[{"url":"picX.jpg", "original":true}],
  "vids":[{"url":["vid.mp4", "vid.ogv"]}, {"url":["vid2.ogv"]}],
  "gpx":"pics/directoryX/mygpx.gpx",
  "gpxtype":"terrain",
  "descr":"dir descr",
}
              </pre>
         </div>


         <h1>1. <a name="en-Theme">Create a theme</a></h1>
         <div style="display:inline-block;text-align:justify;">
           Create a folder in the <i>/themes</i> directory of your EnVadrouille gallery with two files: <i>main.js</i> and <i>main.css</i>. Once these files created, update the administration options to add your theme to the gallery. If you start from an existing theme, creating your own theme might take you less than 5 minutes!<br/>Click on the files bellow to show the minimal content of the css and js files.<br/>
         </div>
         <ol class="tree">
           <li>
             <label for="themes">themes</label> 
             <ol>
               <li>
                 <label for="folder1">MyTheme</label> 
                 <ol>
                   <li class="file"><a href="#" onclick="hide('theme-js'); return showHide('theme-css');">main.css</a></li>
                   <li class="file"><a href="#" onclick="hide('theme-css'); return showHide('theme-js');">main.js</a></li>
                  </ol>
               </li>
             </ol>
           </li>
         </ol>

        <div id="theme-css" style="display:none;">
            There are only two special requirement for the css file. Your css file MUST contain a rule <b>body</b> with a <i>background-color</i> and a <i>color</i> property.
            <pre class="brush: css;">
body {                      /* mandatory */
  background-color:#151515; /* mandatory */
  color:#FFF;               /* mandatory */
}
            </pre>

            This rules are used by the administration to determine the background and foreground colors of your theme. No other rule is enforced. To know which css rules to create, you can either start from an existing theme or look inside the main EnVadrouille /index.html file to find the templates used by the gallery.
            <br/><br/>
            The gallery will work with this single rule (but won't look nice...). The only feature that won't show up are maps because the map container has a default height of 0px. To show the maps, without any decoration, add these rules:

            <pre class="brush: css;">
.gps {
	position:relative;
}
.gpscanvas {
	height:320px;
}
.gpschart {
	display:none; /* chart is hidden by default */
	height:200px;
}
.gpsadvanced {
  display:none; /* button to show charts will be
                   displayed automatically when
                   the gpx has been loaded */
  position:absolute;
  top:280px;
  left:50%;
  cursor:pointer;
}
.gpsadvanced:before {
  content:"Show stats";
}
            </pre>

         </div>

         <div id="theme-js" style="display:none;">
            A theme must implement 8 JavaScript functions. Most of these functions are called with a <b>json argument described <a href="#json-div-a" onclick="showHide('json-div');">here</a></b>. You can add fields to this json but you must NOT alter existing fields (because they might be used internally or by other themes). The following JS example is sufficient to get a fully functionnal gallery.<br/>Alternativelly you can also copy another theme .js file and reuse it; most of the time only the .css file matters!
<br/>
          <pre class="brush: js;">
/*
 * Boolean to tell whether you want the gallery to perform smooth
 * transition between pages (fadeIn/fadeOut)
 */
var animateContent = false;

/*
* Called on all pages, with or without an argument. May be used to display a breadcrumb or anything you want.
* @json: /!\ the json being displayed or *undefined* when performing a search
*        see end of Section 0.2 for the description of the json
*/
function showHeader(json) {
   // Simplest code: do nothing.
}
 
/*
* Called to display galleries.
* @json: the json being displayed; galleries are in the json.dirs field.
* @isGalleryIndex: true if the displayed page is the main gallery page.
*/
function showDirs(json, isGalleryIndex) {
    if(!json.dirs)
        return;
 
  var dirs = [];
  var dirUrl = jGalleryModel.pageToUrl(data.realurl);
  for (var i in json.dirs) {
      dirs[i] = {
          ID:i,
          completeurl:json.dirs[i].completeurl || (dirUrl+json.dirs[i].url),
          thumb:json.dirs[i].thumb || (dirUrl+json.dirs[i].url+'/'+json.dirs[i].thumbs[0]),
          title:json.dirs[i].title || json.dirs[i].url,
          descr:json.dirs[i].descr,
      };
      /* you may also want to set .day , .month, .year and .starred  */
      /* you can also specify a .separator (html string) that will show before the directory */
      /* see the dirTpl template in /index.html to get the list of variables used by the template */
 
      $("#dirTpl").tmpl(dirs[i]).appendTo('#content');
 
      $('#dir'+dirs[i].ID).css('opacity', 1);
      $('#dir'+dirs[i].ID+' img').css('opacity', 1);
      $('#dir'+dirs[i].ID).click({url:json.dirs[i].url}, function(ev) {
        ev.preventDefault();
        jGallery.switchPage(dirUrl+ev.data.url);
      });
  }
}
 
/*
* Called to display pictures
* @json: the json being displayed; pictures are in the json.pics field.
*/
function showPics(json) {
  if(!json.pics)
    return;
 
  var pics = [];
  var dirUrl = jGalleryModel.pageToUrl(data.realurl);
  for (var i in json.pics) {
    pics[i] = {
      ID:i,
      url:(json.pics[i].fullpath?json.pics[i].fullpath:dirUrl),
      big:json.pics[i].url,
      thumb:json.pics[i].url.replace(/\.([^\.]+)$/, "_c.$1"), //pic.jpg -&gt; pic_c.jpg
      original:json.pics[i].original
    };
    $("#picTpl").tmpl(pics[i]).appendTo('#content');
    $('#pic'+i+' img').css('opacity', 1);
  }
 
  $("a[rel*='gal']").colorbox({slideshow:true, slideshowSpeed:3500, slideshowAuto:false, loop:false, maxWidth:'90%', maxHeight:'90%'});
}
 
/*
* Called to display videos
* @json: the json being displayed; videos are in the json.vids field.
*/
function showVids(json) {
  if(!json.vids)
    return;
 
  var dirUrl = jGalleryModel.pageToUrl(data.realurl);
  var vids = [];
  for (var i in json.vids) {
    vids[i] = {
      ID:i,
      vid:json.vids[i].url,
      path:dirUrl,
      h:360,
      w:640
    };
    $("#vidTpl").tmpl(vids[i]).appendTo('#content');
  }
}
 
/*
* Called to display a gpx file
* @json: the json being displayed; gpx is in the json.gpx field.
*/
function showGps(json) {
  if(json.gpx) {
    $("#gpsTpl").tmpl().appendTo('#content');
    jGallery.showGPX(json);
  }
}
 
/*
* Called to display a search result
* @dataFull: the galleries that match all searched keywords
* @dataPartial: the galleries that some of the searched keywords
* @keywords: the searched keywords
*/
function showSearch(dataFull, dataPartial, keywords) {
  if(dataFull.length) {
    showSearchResults(dataFull, keywords);
  }
  if(dataPartial.length) {
    showSearchResults(dataPartial, keywords);
  }
}
function showSearchResults(data, keywords) {
  if(!data)
    return;
 
  for (var i in data) {
    var res = {};
    res.ID = data[i].ID;
    res.url = data[i].url;
    res.descr = data[i].descr;
    res.starred = data[i].starred;
    res.completeurl = data[i].url;
 
    res.title = jGallery.highlightText(data[i].url, keywords);
    res.thumb = data[i].url+'/'+data[i].thumbs[0];
 
    $("#dirTpl").tmpl(res).appendTo('#search_results');
    $('#dir'+res.ID).click({url:res.url}, function(ev) {
      ev.preventDefault();
      jGallery.switchPage(ev.data.url);
    });
  }
}
 
/*
 * Called to display an error.
 * @data: use data.Error to get the error message
 */
function showError(data) {
  $("#errorTpl").tmpl(data).appendTo('#content');
}
 
/*
 * Called before displaying the first page and when the user
 * changes the gallery language.
 * All text in &lt;... class="translate"&gt;&lt;/...&gt; markups will
 * be automatically translated for you.
 * @lang: 'en', 'fr', ...
 */
function changeThemeLang(lang) {
  if(lang == 'fr') {
    config.tr['Hello'] = 'Salut';
    // &lt;span class="translate"&gt;Hello&lt;span&gt; will be shown as "Salut" in French
  }
}
            </pre>
         </div>
         <h1>2. <a name="en-Plugin">Create a plugin</a></h1>
         <h2>2.0 <a name="en-Plugin-0">Philosophy</a></h2>
         The admininistration is composed of a set of plugins. Each view of the administration (index, option, face recognition, etc.) is a plugin. A plugin usually works as follows:
         <ul>
            <li>Display a simple HTML template that contains almost nothing</li>
            <li>Use AJAX calls to get data from the server and add these data to the HTML template</li>
         </ul>

         A plugin is composed of mutiple "actions" (functions): the <b>mainAction</b> that displays the template and multiple other <b>fooAction</b> that are called with AJAX. See bellow for a simple <a href="#en-Plugin-1">Hello World</a> plugin to understand how to perform AJAX calls. The gallery provides convenient functions to perform AJAX calls. DO NOT TRY TO PERFORM THEM BY HAND! Indeed, the custom AJAX functions also add security variables to each AJAX calls that are used internally to prevent XSS attacks. If you perform an AJAX call without these variables, your call will be rejected by the gallery.
         
         <br/><br/>

         Plugins can also be used to modify the gallery (vs the administration). In order to do that, a plugin can tell the gallery to load a javascript file before showing up. The JavaScript file might register various hooks in the gallery to extend its functionality. See the <a href="#en-Plugin-3">Gallery plugin</a> section for more details.</a>


         <h2>2.1 <a name="en-Plugin-1">Administration Plugin - Hello World</a></h2>

         Creating a plugin can be a simple as creating a directory with a php file. We will also use a js and a tpl file to make the example a bit more interesting. Create these files and update the administration options. An Hello World tab will be added to the administration. Click on the files for more details.

         <ol class="tree">
            <li>
            <label for="themes">pages</label> 
            <ol>
               <li>
               <label for="folder1">myplugin</label> 
               <ol>
                  <li class="file"><a href="#" onclick="hide('hello-js'); hide('hello-tpl'); return showHide('hello-index');">index.php</a></li>
                  <li>
                     <label for="folder1">scripts</label>
                     <ol>
                     <li class="file"><a href="#" onclick="hide('hello-tpl'); hide('hello-index'); return showHide('hello-js');">main.js</a></li>
                     </ol>
                  </li>
                  <li>
                     <label for="folder1">tpl</label>
                     <ol>
                     <li class="file"><a href="#" onclick="hide('hello-js'); hide('hello-index'); return showHide('hello-tpl');">index.tpl</a></li>
                     </ol>
                  </li>
               </ol>
               </li>
            </ol>
            </li>
         </ol>

         <div id="hello-js" style="display:none">
            Here is a simple JS file that adds an action to the "Click me" text of the template.

            <pre class="brush: js;">
$(document).ready(function() {
   var nclicks = 0;
	$('#hello').click(function() {
      var batch = new Batch(ParallelBatch, function(data) {
         // All actions in the batch have completed
         // In this example we only launch one action (foo_bar) but you may want to launch multiple actions
         // and get notified when they have all complete.
         // Notice the 'ParallelBatch' that will launch multiple actions in parallel (4 by default). Use
         // SequentialBatch for actions that must be executed sequentially (e.g., multiple actions touching the same file)
         // Note: Sequential and Parallel Batchs operate on a global level, i.e.,
         // var batch1 = new Batch(SequentialBatch);
         // var batch2 = new Batch(SequentialBatch);
         // ...
         // batch1.launch();
         // batch2.launch(); // will only execute once batch1 has completed its action(s).
		}, null);
      batch.get({action:'myplugin.foo_bar', clicks:++nclicks}, function(data) {
         // will call /pages/myplugin/index.php?action=foo_bar&amp;clicks=nclicks&amp;custom_security_variables
         // that will automatically execute the fooBarAction() function of the index.php file
         $('#res').append(data.foo);
      });
      batch.launch(); // Always call that after adding an action to a batch
   });
});
            </pre>
         </div>

         <div id="hello-tpl" style="display:none">
         The administration uses the liteTemplate class to display templates from PHP. Alternatively you can also use the jQuery template plugin if you feel more comfortable displaying templates in JavaScript. Note that variables in liteTemplate are of the form {$VAR} whereas jQuery template plugin used ${var} (notice the emplacement of the $). 

            <pre class="brush: php;">
<div id="hello">{$CLICK}</div>
<div id="res"></div>
            </pre>
         </div>

         <div id="hello-index" style="display:none">
            A plugin must contain an index.php file at its root. Here is a minimal php file that loads a template with a link that that performs an AJAX call.
            <pre class="brush: php;">
/* index.php MUST contain a Page_PluginName_Index class, here: */
class Pages_Myplugin_Index {
   /* Description that will show up in the top menu and in the options; keep it short */
   public static $description = "Hello World";

   /* Can the plugin be deactivated? Should be true */ 
   public static $isOptional = true;

   /* Create a button on the top menu? True only if you want to display something in the administration */
   public static $showOnMenu = true;

   /* 
    * Function called before calling any of the plugin action
    * See the complete plugin example for example usage
    */
   public static function setupAutoload() {
   }

   /* 
    * Function called by the administration options plugin
    * See the complete plugin example for example usage; currently we have no option.
    */
   static public function getOptions() {
      return array();
   }

   static public function mainAction() {
      $template = new liteTemplate();
      $template-&gt;showPage('index'); // Will show ./tpl/index.tpl
      $template-&gt;assign(array('CLICK' =&gt; 'Click me !'));
      $template-&gt;view();
   }

   static public function fooBarAction() {
      $clicks = Controller::getParameter('clicks');
      echo File_JSON::myjson_encode(array(
         "foo" =&gt; "Hello! You have clicked the link $clicks times!"
      ));
   }
};
            </pre>
         </div>

        <h2>2.2 <a name="en-Plugin-2">Gallery plugin - Hello World</a></h2>

       Creating a plugin to enhance the gallery is very simple. It only requires the creation of 2 files. Once you have created these two files, go in the administration option and update the options to register you plugin.

         <ol class="tree">
            <li>
            <label for="themes">pages</label> 
            <ol>
               <li>
               <label for="folder1">myplugin</label> 
               <ol>
                  <li class="file"><a href="#" onclick="hide('gal-js'); return showHide('gal-index');">index.php</a></li>
                  <li>
                     <label for="folder1">scripts</label>
                     <ol>
                     <li class="file"><a href="#" onclick="hide('gal-index'); return showHide('gal-js');">jgallery.myplugin.js</a></li>
                     </ol>
                  </li>
               </ol>
               </li>
            </ol>
            </li>
         </ol>

         <div id="gal-index" style="display:none">
            The index.php file contains two functions. The <i>getOptions</i> function declares an option value that will be "exported" in the gallery and the <i>getUserScripts</i> function tells the gallery which javascript files to load when the plugin is active.

            <pre class="brush: php;">
class Pages_Myplugin_Index {
   public static $description = "Plugin";
   public static $isOptional = true;
   public static $showOnMenu = false;

   public static function setupAutoload() {
   }

   /* We export one variable in the gallery. It will be accessible via config.my_option */
   static public function getOptions() {
      return array(
         array('id' =&gt; 'my_option', 'type' =&gt; 'text', 'cat' =&gt; Pages_Myplugin_Index::$description, 'default' =&gt; 'default value', 'export' =&gt; true),
      );
   }

   /* Tell the gallery to load a js file when this plugin is activated */
   static public function getUserScripts() {
      return array('./admin/pages/myplugin/scripts/jgallery.myplugin.js');
   }
};
            </pre>
         </div>
         <div id="gal-js" style="display:none">
         The javascript file is also very simple. Your plugin can declare 3 functions that will be used automatically by the gallery. You can also overload functions of the gallery to extend them; see bellow.

            <pre class="brush: js;">
var MyPlugin = {
   // called by the gallery on every page change, optionnal
   want:function(action) {
      // if the user is on page #myplugin, tell the gallery we handle the rendering
      return (action == "myplugin");
   },

   // called on actions you "want", optional if you don't handle any action
   handle:function(action) {
      // you told the gallery you wanted an action, now handle it.
   },

   // mandatory, called just before displaying the first page
   init:function(action) {
      alert("Initialized! Config value is "+config.my_option+" !");

      // Tell the gallery we have completed initialization
      // without this line, the want/handle functions will never be called
      jGallery.plugins.push(MyPlugin);


      // You may also want to overload some functions of the gallery to add extra features, for example, do a:
      var oldSearch = jGallery.realSearch;
      jGallery.realSearch = function(txt) {
         // don't forget to call oldSearch(txt) if you don't want to handle this search!
      };

      // You can also register triggers to some of the gallery events
      // Currently only one event is fired: the language change event:
      $("document").bind("customtranslate", function() {
         //&lt;span class="translate"&gt;Hello&lt;/span&gt; will show up as "Salut" in french
         if(lang == "fr") {
            config.tr["Hello"] = "Salut";
         } else {
            delete config.tr["Hello"];
         }
      });
   },
};

// Tell the gallery to initialize us when all important javascript files have been loaded.
config.pluginsInstances.push(MyPlugin);
         </pre>
        </div>


        <h2>2.2 <a name="en-Plugin-3">Available classes and hacks</a></h2>

         <h3>2.2.0 <a name="en-Plugin-3-0">Available classes</a></h3>
TODO

         <h3>2.2.1 <a name="en-Plugin-3-1">Files manipulation</a></h3>
The main task of the administration is to deal with files (pictures, json) and directories. The gallery provides cool abstractions to ease the most common operations on files and directories. We recommend that you use these abstractions. See <a href="">here</a> for the complete lists of classes that you may use in the gallery.

<br/>
If these classes do not meet your needs, you can extend them and make the gallery use your own abstractions instead of the generic ones. For example, without any modifications, all png files are of type File_Pic. If you want all png files to be of type MyPic, here is how to do it:

            <pre class="brush: php;" style="display:none">
// Create a file named mypic.php in pages/myplugin/php/ with
class MyPic extends File_Pic {
   public function __construct($path, $name = '') {
       parent::__construct($path, $name);
       // custom initialization
   }

   public function customFunction() { };
}

// and in you plugin index pages/myplugin/index.php:
class Pages_Myplugin_Index {
   public static function setupAutoload() {
      AutoLoader::$autoload_path[] = "./pages/myplugin/php/";
      File_Factory::registerExtension("png", "MyPic"); // all png files are of type MyPic!

      // Note: You can register the special extension "dir" for directories.
   }

   public static function mainAction() { 
      $dir = new Dir('./path');
      $files = $dir-&gt;getPics();
      foreach($files as $file) {
         // all png files are of type MyPic
         if(strtolower($file-&gt;extension) === 'png')
            $file-&gt;customFunction(); // works
      }
   }
}
         </pre>


         <h3>2.2.2 <a name="en-Plugin-3-2">Use multiple JS files in an administration plugin</a></h3>
         By default the gallery will look for a main.js file in the script directory of your plugin. You may want to inform the gallery that you want to load other js files as follows:
         <pre class="brush: php;">
class Pages_Myplugin_Index {
   // ...

   static public function mainAction() {
      $template = new liteTemplate();
      $template-&gt;extraJS[] = './pages/myplugin/scripts/extrajs.js';
      $template-&gt;showPage('index');
      $template-&gt;view();
   }
}
         </pre>

         
         <h3>2.2.3 <a name="en-Plugin-3-3">Translation in the administration</a></h3>
         The gallery will also automatically try to load translation files for your plugins. You need exactly two files for each language: one file that will be used to render the content of your templates and one file that will be used for the description of your plugin options. All text that is in a DOM element with a class "translate" will be translated (that works for inputs and selects too).

<br/>
E.g.,
         &lt;span class="translate"&gt;test_translate&lt;/span&gt; will look for a way to translate test_translate in the current administration language.<br/><br/>
         Translation in the administration is way more powerful than in the gallery and you may want to use function or special formatters to translate the content of your divs. See bellow.

         Sample translation files for a plugin:
         <ol class="tree">
            <li>
            <label for="themes">pages</label> 
            <ol>
               <li>
               <label for="folder1">myplugin</label> 
               <ol>
                  <li>
                     <label for="folder1">scripts</label>
                     <ol>
                     <li>
                        <label for="folder1">lang</label>
                        <ol>
                           <li class="file"><a href="#" onclick="hide('lang-option-js'); return showHide('lang-js');">en.js</a></li>
                           <li class="file"><a href="#" onclick="hide('lang-js'); return showHide('lang-option-js');">option_en.js</a></li>
                           <li class="file"><a href="#" onclick="hide('lang-option-js'); return showHide('lang-js');">fr.js</a></li>
                           <li class="file"><a href="#" onclick="hide('lang-js'); return showHide('lang-option-js');">option_fr.js</a></li>
                        </ol>
                     </li>
                     </ol>
                  </li>
               </ol>
               </li>
            </ol>
            </li>
         </ol>

         <div id="lang-option-js" style="display:none">
option_en.js and option_fr.js files:
         <pre class="brush: js;">
/* This file will be used by the option */
known_sentences.concat({
   'Hello World':'Hello World plugin',
   'my_option':'My option',
};
         </pre>
         <pre class="brush: js;">
/* This file will be used by the option */
known_sentences.concat({
   'Hello World':'Plugin Hello World',
   'my_option':'Mon option',
};
         </pre>
         </div>
         <div id="lang-js" style="display:none">
en.js file, fr.js file would contain the same content but translated:
         <pre class="brush: js;">
/* This file will be used by your scripts */
known_sentences.concat({
   't1':'Translation 1',
   't2':'{0} done / {1} total',
   't3':function(args) {
      return 'Translation 3: ' + args[0];
   },
};
         </pre>
      
         To translate in the adminstration:
         <pre class="brush: js;">
// Elements with a class="translate" will be translated automatically after the page load.
// However if you add elements later on (e.g., after receiving an AJAX response), you must
// inform the gallery that it must perform new translations. This can be done in a single line:
$(".translate").translate();

// If you want to use arguments in your translations, you have to put the translated text directly
// in your templates as follows:
$("...").append(... + t('t2', [ 0, 1 ]);
$("...").append(... + t('t3', [ 0, 1, 2, 3, ... ]);
         </pre>
         </div>

         <h3>2.2.4 <a name="en-Plugin-3-4">Information popups in the administration</a></h3>
        Another great feature of the administration is the information system. You can either inform the user of a success, warn him or report an error. Note that if an AJAX call fails, an error with detailed information will show up automatically.

         <pre class="brush: js;">
function inform(tag, type, add, params, div);

// E.g., the following will show a "success" div on top of the page containing
// the translation of t2 (e.g., "done 0 / 1" here, click on the "en.js" file in the previous subsection to know why).
// true is used to say that you want to add the div (false will remove the div)
// By default the div show on top of the page but you can specify the container div using the div parameter
inform('t2', 'success', true, [0, 1]);
         </pre>

        <h2>2.4 <a name="en-Plugin-4">Complete example</a></h2>

        Click <a href="">here</a> to download a complete example of a plugin. This plugin adds a tab in the admin and registers a pligin in the gallery. It uses custom classes to handle files and is translated in english and french. In brief, it should contain everything that is required to make a fully functionnal plugin!


               </div>
      <script type="text/javascript">
        SyntaxHighlighter.all()
      </script>
   </body>
</html>
