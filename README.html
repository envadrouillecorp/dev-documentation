<!DOCTYPE HTML>
<html>
   <head>
      <meta http-equiv="content-Type" content="text/html; charset=utf-8" />
      <title>README</title>
      <style type="text/css">
         body {
            margin: 0px 8% 4em 8%;
            padding-top: 18pt;
            background-color:white;
            color:black;
            text-align:justify;
         }
         .menu li {
            list-style:none;
         }
         .menu, h1,h2,h3 {
            color:#990000;
         }
         h1 a, h2 a, h3 a {
            color:#000;
         }
         .menu a {
            color:#000;
            text-decoration:none;
            border-bottom:1px dotted black;
         }
         li {
            line-height:2em;
         }
         .envadrouille {
            font-style:italic;
         }
         .title {
            font-family:Georgia, "Times New Roman", Times, serif;
            line-height:1.2;
            font-size:4.4em;
            text-align:center;
         }
         .language { 
         }


         /* CSS Tree menu styles */
         ol.tree
         {
           padding: 0 0 0 30px;
         }
         ol.tree li 
         { 
           list-style: none;
         }
         li.file
         {
           margin-left: -1px !important;
           background: url(css/document.png) 0 7px no-repeat;
           color: #000;
           padding-left: 21px;
           display: block;
           position:relative;
         }
         li.file a
         {
           text-decoration: none;
         }
         ol.tree li label
         {
           background: url(css/folder-horizontal.png) 15px 7px no-repeat;
           cursor: pointer;
           display: block;
           padding-left: 37px;
           position:relative;
         }
         ol.tree .descr {
            position:absolute;
            left:180px;
            color:#444;
            font-style:italic;
            font-size:12px;
         }

         .toolbar {
           display:none!important;
         }
       </style>
       <script type="text/javascript">
       function hide(div) {
          var d = document.getElementById(div);
          d.style.display = 'none';
          return false;
       }

       function showHide(div) {
          var d = document.getElementById(div);
          if(d.style.display == 'none')
            d.style.display = 'block';
          else
            d.style.display = 'none';
          return false;
       }
       </script>
       <script type="text/javascript" src="js/jquery.min.js"></script>
       <script type="text/javascript" src="js/shCore.js"></script>
       <script type="text/javascript" src="js/shBrushJScript.js"></script>
       <script type="text/javascript" src="js/shBrushCss.js"></script>
       <script type="text/javascript" src="js/shBrushPhp.js"></script>
       <script type="text/javascript" src="js/shBrushXml.js"></script>
       <link href="css/shCore.css" rel="stylesheet" type="text/css" />
       <link href="css/shThemeDefault.css" rel="stylesheet" type="text/css" />
   </head>
   <body>
      <div class="title">EnVadrouille - Developers</div>


      <div id="en" class="language">
         <ul id="mainmenu" class="menu"></ul>
<script>
$(document).ready(function() {
   var uid = 0;
   function showChild(parent, div, rec, hid) {
      if(rec > 3)
         return;

      var elts;
      if(parent) 
         elts = $(parent).nextUntil('h'+(rec-1)).filter('h'+rec);
      else
         elts = $(document).find('h'+rec);
      elts.each(function(id, v) {
         var text = $(v).text();
         var num = ((hid)?(hid+'.'):'')+(id+1);
         var link = uid++;
         $(v).html(num + ' <a name='+link+'>'+text+'</a>');
         div.append('<li>'+num+' <a href="#'+link+'">'+text+'</a></li><ul id="h'+rec+'_'+uid+'"></ul>');
         showChild(v, $('#h'+rec+'_'+uid), rec+1, num);
      });
   }
   showChild(null, $('#mainmenu'), 1, null);
});
</script>


         <h1>General information about EnVadrouille</h1>
         Here are some general information about EnVadrouille that might be useful to create themes and plugins.

         <h2>Available scripts</h2>
         In the gallery, you may safely assume that the following API will be automatically loaded:
         <ul>
            <li>jQuery v1.7</li>
            <li>jQuery template plugin, see <a href="https://github.com/jquery/jquery-tmpl">https://github.com/jquery/jquery-tmpl</a></li>
            <li>jQuery color animation plugin (you can animate background-color, using jQuery animate)</li>
            <li>jQuery url plugin (you can use $.url)</li>
            <li>jQuery cookie plugin (you can use $.cookie)</li>
            <li>jQuery doTimeout plugin, see <a href="http://benalman.com/projects/jquery-dotimeout-plugin/">http://benalman.com/projects/jquery-dotimeout-plugin/</a></li>
            <li>jQuery ColorBox v1.3.34 (slideshow plugin), see <a href="http://www.jacklmoore.com/colorbox">http://www.jacklmoore.com/colorbox</a></li>
            <li>A custom script loader named $script, see below.</li>
         </ul>

         <br/>
         To know when an API has been loaded, use the $script API as follows:
         <pre class="brush: js;">
$script("http://domain/foo.js", "foo", function() {
   // code that will be executed once foo.js has been loaded
   // this function is optional, you can call $script with only 2 arguments
});
$script.loaded(['foo', 'jquery', 'colorbox'], function() {
   // code that will get executed once foo, jquery and colorbox have been loaded
});
         </pre>

         <br/>

         <h2>Paths, thumbnails, jsons</h2>
         <table>
           <tr>
             <td valign="top" width="1000px" style="padding-right:20px;text-align:justify">
               <ol class="tree">
                 <li>
                   <label for="admin">admin</label> 
                   <ol>
                    <li>
                       <label for="common">common <span class="descr">general libraries, see <a href="#en-Plugin-3">section 2.3</a></span></label> 
                       <label for="pages">pages <span class="descr">plugins, see <a href="#en-Plugin">section 2</a></label> 
                    </li>
                   </ol>

                  <label for="cache">cache</label> 
                   <ol>
                    <li>
                       <label for="json">json</label> 
                       <ol>
                          <li>
                             <li class="file">cache.json <span class="descr">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json containing the metadata of the index, <a href="#" onclick="return showHide('json-div');">click here</a> to see an example (content will appear bellow the list of files)</span></li>
                             <label for="directoryX">directoryX</label> 
                             <ol>
                              <li class="file">cache.json <span class="descr">json containing the metadata of directoryX, <a href="#" onclick="return showHide('json-div');">click here</a> to see an example (content will appear bellow the list of files)</span></li>
                             </ol>
                          </li>
                       </ol>
                       <label for="thumbs">thumbs</label> 
                       <ol>
                          <li>
                             <label for="admin">directoryX</label> 
                             <ol>
                              <li class="file">picX_r.jpg <span class="descr">main thumbnail for picX; size configured in the admin</span></li>
                              <li class="file">picX_b.jpg <span class="descr">big thumbnail, width=350px, height depends on the original height</span></li>
                              <li class="file">picX_c.jpg <span class="descr">crop thumbnail, 200px*150px</span></li>
                              <li class="file">picX_m.jpg <span class="descr">small thumbnail, width=150px, height depends on the original height</span></li>
                             </ol>
                          </li>
                       </ol>
                    </li>
                   </ol>

                  <label for="pics">pics</label> 
                  <ol>
                        <li>
                           <label for="admin">directoryX</label> 
                           <ol>
                            <label for="admin">subdirectoryX</label> 
                            <li class="file">mygpx.gpx</li>
                            <li class="file">picX.jpg</li>
                            <li class="file">vid.ogv</li>
                            <li class="file">vid.mp4 <span class="descr">vid.ogv and vid.mp4 are the same video with different codecs</span></li>
                            <li class="file">vid2.ogv</li>
                           </ol>
                        </li>
                     </ol>

                  <label for="themes">themes</label> 
                  <ol>
                        <li>
                           <label for="themeX">themeX</label> 
                        </li>
                     </ol>

                  <label for="themes">scripts</label> 
                 </li>
               </ol>
             </td>
             <td>
             </td>
           </tr>
         </table>

<br/>
        <div id="json-div" style="display:none;">
          <pre class="brush: js;">
// See bellow for real examples
// All variables named foo* may be undefined
{
  dirs*:[                                                              // list of subdirectories
    {
       ID:&lt;display order&gt;,                                             // e.g., 0 
       url:&lt;name of the directory&gt;,                                    // e.g., 'subdirdirX' 
       thumbs:[&lt;name of thumbs&gt;],                                      // e.g., ['index_m.jpg', '0_m.jpg'] 
                                                                       // You can replace _m with _c or _b in your code 
                                                                       // to access thumbnails of different size 
       descr:&lt;description&gt;,                                            // e.g., 'foobar' 
       starred:&lt;true if the directory should be highlighted&gt;,  
    }
  ],
  pics*:[                                                              // list of pictures
    {
       url:&lt;name of the picture&gt;,                                      // e.g., foo.jpg
       fullpath*:&lt;path of the picture (if undefined, path=path of the gallery)&gt; 
       original:true if the original picture is bigger than the _r thumbnail
    }
  ],
  vids*:[                                                              // list of videos
    {
      url:[&lt;nameS of the video&gt;]                                       // e.g., [foo.mp4, foo.ogv]
    }                                                                  // /!\ videos with same basename but different
                                                                       // extensions are regrouped!
  ],
  gpx*:[&lt;PATH of the gpx files of the gallery&gt;] or [],
  gpxtype*:&lt;maps type, "terrain", "satellite" or "roadmap"&gt;
  descr*:&lt;description of the gallery&gt;
}

//E.g., for the files presented before
//    /cache/json/cache.json, the cache.json of the index of the gallery:
{
  "dirs":[{"ID":0, "url":"directoryX", "thumbs":['picX_m.jpg'], "descr":"dir descr", starred:false}],
}

//    /cache/json/directoryX/cache.json, the cache.json of directoryX:
{
  "dirs":[{"ID":0, "url":"subdirectoryX", "thumbs":[], "descr":"subdir descr", starred:false}],
  "pics":[{"url":"picX.jpg", "original":true}],
  "vids":[{"url":["vid.mp4", "vid.ogv"]}, {"url":["vid2.ogv"]}],
  "gpx":["pics/directoryX/mygpx.gpx"],
  "gpxtype":"terrain",
  "descr":"dir descr",
}
              </pre>
         </div>


<br/>
<br/>
<br/>
<br/>

         <h1>Create a theme</h1>
         <div style="display:inline-block;text-align:justify;">
           Create a folder in the <i>/themes</i> directory of your EnVadrouille gallery with two files: <i>main.js</i> and <i>main.css</i>. Once these files created, update the administration options to add your theme to the gallery. If you start from an existing theme, creating your own theme might take you less than 5 minutes!<br/>Click on the files bellow to show the minimal content of the css and js files.<br/>
         </div>
         <ol class="tree">
           <li>
             <label for="themes">themes</label> 
             <ol>
               <li>
                 <label for="folder1">mytheme</label> 
                 <ol>
                   <li class="file"><a href="#" onclick="hide('theme-js'); return showHide('theme-css');">main.css</a> [click or download <a href="code/mytheme/main.css">full file</a>]</li>
                   <li class="file"><a href="#" onclick="hide('theme-css'); return showHide('theme-js');">main.js</a> [click or download <a href="code/mytheme/main.js">full file</a>]</li>
                  </ol>
               </li>
             </ol>
           </li>
         </ol>

        <div id="theme-css" style="display:none;">
            There are only two special requirement for the css file. Your css file MUST contain a rule <b>body</b> with a <i>background-color</i> and a <i>color</i> property.
            <pre class="brush: css;">
body {                      /* mandatory */
  background-color:#151515; /* mandatory */
  color:#FFF;               /* mandatory */
}
            </pre>

            This rules are used by the administration to determine the background and foreground colors of your theme. No other rule is enforced. To know which css rules to create, you can either start from an existing theme or look inside the main EnVadrouille /index.html file to find the templates used by the gallery.
            <br/><br/>
            The gallery will work with this single rule (but won't look nice...). The only feature that won't show up are maps because the map container has a default height of 0px. To show the maps, without any decoration, add these rules:

            <pre class="brush: css;">
.gps {
   position:relative;
}
.gpscanvas {
   height:320px;
}
.gpscanvasbig {
   height:800px;
}
.gpschart {
   display:none; /* chart is hidden by default */
   height:200px;
   width:100%;
}
.gpsmapwrapper {
   position:relative;
}
.gpsadvanced {
   display:none; /* button to show charts will be
                   displayed automatically when
                   the gpx has been loaded */
   position:absolute;
   bottom:0px;
   left:50%;
   margin-left:-60px;
   cursor:pointer;
   display:none;
}
.gpsadvanced:before {
   content:"STATS";
}
.gpsbigger {
   display:none;
   position:absolute;
   bottom:0px;
   left:50%;
   cursor:pointer;
}
.gpsbigger:before {
   content:"BIGGERMAP";
}            </pre>

         </div>

         <div id="theme-js" style="display:none;">
            A theme must implement 6 JavaScript function. Most of these functions are called with a json argument described <a href="#json-div-a" onclick="showHide('json-div');">here</a>. You can add fields to this json but you must NOT alter existing fields (because they might be used internally or by other themes).<br/>The simplest way to create this JavaScript file is to start from an existing theme.
<br/>
          <pre class="brush: js;">
var myTheme = {
   /*
    * Boolean to tell whether you want the gallery to perform smooth
    * transition between pages (fadeIn/fadeOut)
    */
   animateContent : false,
 
   /*
   * Called on all pages, with or without an argument. May be used to display a breadcrumb or anything you want.
   * @json: /!\ the json being displayed or *undefined* when performing a search
   */
   showHeader:function(json) {
      // Simplest code: do nothing.
   },
 
   /*
   * Called multiple times most pages to display content.
   * @content the content to display (e.g., 'dirs', 'pics', 'vids', 'gpx', ...)
   * @json the json being displayed
   */
   showContent:function(content, json) {
      switch(content) {
        case 'dirs': return myTheme.showDirs(json);
        case 'pics': return myTheme.showPics(json);
        case 'vids': return myTheme.showVids(json);
        default: return jGallery.defaultContent(content, json);
      }
   },
 
   /*
   * Called to display a search result
   * @dataFull: the galleries that match all searched keywords
   * @dataPartial: the galleries that some of the searched keywords
   * @keywords: the searched keywords
   */
   showSearch:function(dataFull, dataPartial, keywords) {
     if(dataFull.length) {
       myTheme.showSearchResults(dataFull, keywords);
     }
     if(dataPartial.length) {
       myTheme.showSearchResults(dataPartial, keywords);
     }
   },
   showSearchResults:function(data, keywords) {
     if(!data)
       return;
     
     for (var i in data) {
       var res = {};
       res.ID = data[i].ID;
       res.url = data[i].url;
       res.descr = data[i].descr;
       res.starred = data[i].starred;
       res.completeurl = data[i].url;
     
       res.title = jGallery.highlightText(data[i].url, keywords);
       res.thumb = data[i].url+'/'+data[i].thumbs[0];
     
       $("#dirTpl").tmpl(res).appendTo('#search_results');
       $('#dir'+res.ID).click({url:res.url}, function(ev) {
         ev.preventDefault();
         jGallery.switchPage(ev.data.url);
       });
     }
   },
 
   /*
    * Called to display an error.
    * @data: use data.Error to get the error message
    */
   showError:function(data) {
     $("#errorTpl").tmpl(data).appendTo('#content');
   },
     
   /*
    * Called before displaying the first page and when the user
    * changes the gallery language.
    * All text in <... class="translate"></...> markups will
    * be automatically translated for you.
    * @lang: 'en', 'fr', ...
    */
   changeThemeLang:function(lang) {
     if(lang == 'fr') {
       config.tr['Hello'] = 'Salut';
       // <span class="translate">Hello<span> will be shown as "Salut" in French
     }
   },
};
// your theme must be in /theme/mytheme
config.loadedThemes['mytheme'] = myTheme;
          </pre>

You are free to handle (or not to handle) any of the content that is passed as an argument to showContent. A default function is provided for 'gpx' but you should handle the 'dirs', 'pics' and 'vids' contents. Here is an example of functions that you may use to show galleries, pictures and videos:<br/>
          <pre class="brush: js;">
var myTheme = {

   // ... functions declared before

   /*
   * Called to display galleries.
   * @json: the json being displayed; galleries are in the json.dirs field.
   */
   showDirs:function(json) {
       if(!json.dirs)
           return;
     
     var dirs = [];
     var dirUrl = jGalleryModel.pageToUrl(json.realurl);
     for (var i in json.dirs) {
         dirs[i] = {
             ID:i,
             completeurl:json.dirs[i].completeurl || (dirUrl+json.dirs[i].url),
             thumb:json.dirs[i].thumb || (dirUrl+json.dirs[i].url+'/'+json.dirs[i].thumbs[0]),
             title:json.dirs[i].title || json.dirs[i].url,
             descr:json.dirs[i].descr,
         };
         /* you may also want to set .day , .month, .year and .starred  */
         /* you can also specify a .separator (html string) that will show before the directory */
         /* see the dirTpl template in /index.html to get the list of variables used by the template */
     
         $("#dirTpl").tmpl(dirs[i]).appendTo('#content');
     
         $('#dir'+dirs[i].ID).css('opacity', 1);
         $('#dir'+dirs[i].ID+' img').css('opacity', 1);
         $('#dir'+dirs[i].ID).click({url:json.dirs[i].url}, function(ev) {
           ev.preventDefault();
           jGallery.switchPage(dirUrl+ev.data.url);
         });
     }
   },
  
   /*
   * Called to display pictures
   * @json: the json being displayed; pictures are in the json.pics field.
   */
   showPics:function(json) {
     if(!json.pics)
       return;
     
     var pics = [];
     var dirUrl = jGalleryModel.pageToUrl(json.realurl);
     for (var i in json.pics) {
       pics[i] = {
         ID:i,
         url:(json.pics[i].fullpath?json.pics[i].fullpath:dirUrl),
         big:json.pics[i].url,
         thumb:json.pics[i].url.replace(/\.([^\.]+)$/, "_c.$1"), //pic.jpg -> pic_c.jpg
         original:json.pics[i].original
       };
       $("#picTpl").tmpl(pics[i]).appendTo('#content');
       $('#pic'+i+' img').css('opacity', 1);
     }
     
     $("a[rel*='gal']").colorbox({slideshow:true, slideshowSpeed:3500, slideshowAuto:false, loop:false, maxWidth:'90%', maxHeight:'90%'});
   },
  
   /*
   * Called to display videos
   * @json: the json being displayed; videos are in the json.vids field.
   */
   showVids:function(json) {
     if(!json.vids)
       return;
     
     var dirUrl = jGalleryModel.pageToUrl(json.realurl);
     var vids = [];
     for (var i in json.vids) {
       vids[i] = {
         ID:i,
         vid:json.vids[i].url,
         path:dirUrl,
         h:360,
         w:640
       };
       $("#vidTpl").tmpl(vids[i]).appendTo('#content');
     }
   },
};
 
            </pre>
         </div>

<br/>
<br/>
<br/>
<br/>
         <h1>Create a plugin</h1>

         <h2>Denomination</h2>
         The admininistration is composed of a set of plugins. Each view of the administration (index, option, face recognition, etc.) is a plugin. Some types of files handled by the gallery (e.g., gpx files) are handled by plugins. We call plugins that display a new view <b>"administration plugins"</b> and plugins that handle new type of files <b>"content plugins"</b>. Both type of plugins can export data/functions to the main gallery.<br/>

Plugins can also be used to modify the gallery (vs the administration). In order to do that, a plugin can tell the gallery to load a javascript file before showing up. The JavaScript file might register various hooks in the gallery to extend its functionality. 
         Creating a plugin can be a simple as creating a directory with a php file. We will also use js and tpl files to make the examples a bit more interesting. 


         <h2>Content Plugins</h2>
         <h3>Philosophy</h3>
         <h3>Handling .hello files</h3>
        Creating a plugin to enhance the gallery is very simple. It only requires the creation of 1 php file. For a more complete example, see the gpx plugin that is shipped with the gallery.

         <ol class="tree">
            <li>
            <label for="themes">pages</label> 
            <ol>
               <li>
               <label for="folder1">myplugin</label> 
               <ol>
                  <li class="file"><a href="#" onclick="hide('gal-js'); return showHide('gal-index');">index.php</a> [click or download <a href="./code/myplugin1/index.php.txt">the file</a>]</li>
               </ol>
               </li>
            </ol>
            </li>
         </ol>

         <div id="gal-index" style="display:none">
            The index.php file mainly does 2 things: it exports a function to the gallery that will alert the user that a gallery contains a .hello file and it writes a field in .json files used by the gallery.

            <pre class="brush: php;">
/*
 * Do not forget to activate the plugin in the administration before testing!
 * Then update a directory that contains a .hello file and go into the gallery. It will show an alert box.
 */
class Pages_Myplugin_Index {
   public static $description = "Plugin";
   public static $isOptional = true;
   public static $showOnMenu = false;

   public static $userContentName = "hello";   // The name of what I will show
                                               // Will call showContent('hello', json) in the gallery
   public static $userContentDefaultPosition = 1; // the gallery shows elements in this order by default:
                                                  // galeries, pictures, videos. Insert at position 1 to show 
                                                  // galeries, hello, pictures and videos.

    /* Export one function to the gallery. 
    * Note that we could have put the code in a file and used the getUserScript function
    * to make the gallery load the file (recommended if you have a lot of code to load),
    *  see 2nd example
    */
   static public function getUserFunctions() {
       return array(
          'config.contentPlugins["hello"] = function(json) {
               if(json.hashello) // written by the writeJSON function
                  alert("There is an hello file in this gallery!");
           }'
       );
   }

   /* Called when the gallery writes a JSON. Add our field. */
   public static function writeJSON($new_json_content, $old_json) {
      $json = array();

      $files = $old_json-&gt;masterDirectory-&gt;getFiles();
      foreach($files as $f) {
         if($f-&gt;extension == 'hello') {
            $json['hashello'] = true;
         }
      }
      return $json;
   }
};
            </pre>
         </div>

         <h3>A more complex example</h3>
 
         <h2>Administration Plugins</h2>
         <h3>Philosophy</h3>
         An administration plugin usually works as follows:
         <ul>
            <li>Display a simple HTML template that contains almost nothing</li>
            <li>Use AJAX calls to get data from the server and add these data to the HTML template</li>
         </ul>

         A plugin is composed of multiple "actions" (functions): the <b>mainAction</b> that displays the template and multiple other <b>fooAction</b> that are called with AJAX. See bellow for a simple Hello World plugin to understand how to perform AJAX calls. The gallery provides convenient functions to perform AJAX calls. DO NOT TRY TO PERFORM THEM BY HAND! Indeed, the custom AJAX functions also add security variables to each AJAX calls that are used internally to prevent XSS attacks. If you perform an AJAX call without these variables, your call will be rejected by the gallery.
         
         <br/><br/>

         
         <h3>Hello world</h3>
         <ol class="tree">
            <li>
            <label for="themes">pages</label> 
            <ol>
               <li>
               <label for="folder1">myplugin</label> 
               <ol>
                  <li class="file"><a href="#" onclick="hide('hello-js'); hide('hello-tpl'); return showHide('hello-index');">index.php</a></li>
                  <li>
                     <label for="folder1">scripts</label>
                     <ol>
                     <li class="file"><a href="#" onclick="hide('hello-tpl'); hide('hello-index'); return showHide('hello-js');">main.js</a></li>
                     </ol>
                  </li>
                  <li>
                     <label for="folder1">tpl</label>
                     <ol>
                     <li class="file"><a href="#" onclick="hide('hello-js'); hide('hello-index'); return showHide('hello-tpl');">index.tpl</a></li>
                     </ol>
                  </li>
               </ol>
               </li>
            </ol>
            </li>
         </ol>

         <div id="hello-js" style="display:none">
            Here is a simple JS file that adds an action to the "Click me" text of the template.

            <pre class="brush: js;">
$(document).ready(function() {
   var nclicks = 0;
	$('#hello').click(function() {
      var batch = new Batch(ParallelBatch, function(data) {
         // All actions in the batch have completed
         // In this example we only launch one action (foo_bar) but you may want to launch multiple actions
         // and get notified when they have all complete.
         // Notice the 'ParallelBatch' that will launch multiple actions in parallel (4 by default). Use
         // SequentialBatch for actions that must be executed sequentially (e.g., multiple actions touching the same file)
         // Note: Sequential and Parallel Batchs operate on a global level, i.e.,
         // var batch1 = new Batch(SequentialBatch);
         // var batch2 = new Batch(SequentialBatch);
         // ...
         // batch1.launch();
         // batch2.launch(); // will only execute once batch1 has completed its action(s).
		}, null);
      batch.get({action:'myplugin.foo_bar', clicks:++nclicks}, function(data) {
         // will call /pages/myplugin/index.php?action=foo_bar&amp;clicks=nclicks&amp;custom_security_variables
         // that will automatically execute the fooBarAction() function of the index.php file
         $('#res').append(data.foo);
      });
      batch.launch(); // Always call that after adding an action to a batch
   });
});
            </pre>
         </div>

         <div id="hello-tpl" style="display:none">
         The administration uses the liteTemplate class to display templates from PHP. Alternatively you can also use the jQuery template plugin if you feel more comfortable displaying templates in JavaScript. Note that variables in liteTemplate are of the form {$VAR} whereas jQuery template plugin used ${var} (notice the emplacement of the $). 

            <pre class="brush: php;">
<div id="hello">{$CLICK}</div>
<div id="res"></div>
            </pre>
         </div>

         <div id="hello-index" style="display:none">
            A plugin must contain an index.php file at its root. Here is a minimal php file that loads a template with a link that that performs an AJAX call.
            <pre class="brush: php;">
/* index.php MUST contain a Page_PluginName_Index class, here: */
class Pages_Myplugin_Index {
   /* Description that will show up in the top menu and in the options; keep it short */
   public static $description = "Hello World";

   /* Can the plugin be deactivated? Should be true */ 
   public static $isOptional = true;

   /* Create a button on the top menu? True only if you want to display something in the administration */
   public static $showOnMenu = true;

   /* 
    * Function called before calling any of the plugin action
    * See the complete plugin example for example usage
    */
   public static function setupAutoload() {
   }

   /* 
    * Function called by the administration options plugin
    * See the complete plugin example for example usage; currently we have no option.
    */
   static public function getOptions() {
      return array();
   }

   static public function mainAction() {
      $template = new liteTemplate();
      $template-&gt;showPage('index'); // Will show ./tpl/index.tpl
      $template-&gt;assign(array('CLICK' =&gt; 'Click me !'));
      $template-&gt;view();
   }

   static public function fooBarAction() {
      $clicks = Controller::getParameter('clicks');
      echo File_JSON::myjson_encode(array(
         "foo" =&gt; "Hello! You have clicked the link $clicks times!"
      ));
   }
};
            </pre>
         </div>


       

        <h2>Available classes and hacks</h2>

         <h3>Available classes</h3>
TODO

         <h3>Files manipulation</h3>
The main task of the administration is to deal with files (pictures, json) and directories. The gallery provides cool abstractions to ease the most common operations on files and directories. We recommend that you use these abstractions. See <a href="">here</a> for the complete lists of classes that you may use in the gallery.

<br/>
If these classes do not meet your needs, you can extend them and make the gallery use your own abstractions instead of the generic ones. For example, without any modifications, all png files are of type File_Pic. If you want all png files to be of type MyPic, here is how to do it:

            <pre class="brush: php;" style="display:none">
// Create a file named mypic.php in pages/myplugin/php/ with
class MyPic extends File_Pic {
   public function __construct($path, $name = '') {
       parent::__construct($path, $name);
       // custom initialization
   }

   public function customFunction() { };
}

// and in you plugin index pages/myplugin/index.php:
class Pages_Myplugin_Index {
   public static function setupAutoload() {
      AutoLoader::$autoload_path[] = "./pages/myplugin/php/";
      File_Factory::registerExtension("png", "MyPic"); // all png files are of type MyPic!

      // Note: You can register the special extension "dir" for directories.
   }

   public static function mainAction() { 
      $dir = new Dir('./path');
      $files = $dir-&gt;getPics();
      foreach($files as $file) {
         // all png files are of type MyPic
         if(strtolower($file-&gt;extension) === 'png')
            $file-&gt;customFunction(); // works
      }
   }
}
         </pre>


         <h3>Use multiple JS files in an administration plugin</h3>
         By default the gallery will look for a main.js file in the script directory of your plugin. You may want to inform the gallery that you want to load other js files as follows:
         <pre class="brush: php;">
class Pages_Myplugin_Index {
   // ...

   static public function mainAction() {
      $template = new liteTemplate();
      $template-&gt;extraJS[] = './pages/myplugin/scripts/extrajs.js';
      $template-&gt;showPage('index');
      $template-&gt;view();
   }
}
         </pre>

         
         <h3>Translation in the administration</h3>
         The gallery will also automatically try to load translation files for your plugins. You need exactly two files for each language: one file that will be used to render the content of your templates and one file that will be used for the description of your plugin options. All text that is in a DOM element with a class "translate" will be translated (that works for inputs and selects too).

<br/>
E.g.,
         &lt;span class="translate"&gt;test_translate&lt;/span&gt; will look for a way to translate test_translate in the current administration language.<br/><br/>
         Translation in the administration is way more powerful than in the gallery and you may want to use function or special formatters to translate the content of your divs. See bellow.

         Sample translation files for a plugin:
         <ol class="tree">
            <li>
            <label for="themes">pages</label> 
            <ol>
               <li>
               <label for="folder1">myplugin</label> 
               <ol>
                  <li>
                     <label for="folder1">scripts</label>
                     <ol>
                     <li>
                        <label for="folder1">lang</label>
                        <ol>
                           <li class="file"><a href="#" onclick="hide('lang-option-js'); return showHide('lang-js');">en.js</a></li>
                           <li class="file"><a href="#" onclick="hide('lang-js'); return showHide('lang-option-js');">option_en.js</a></li>
                           <li class="file"><a href="#" onclick="hide('lang-option-js'); return showHide('lang-js');">fr.js</a></li>
                           <li class="file"><a href="#" onclick="hide('lang-js'); return showHide('lang-option-js');">option_fr.js</a></li>
                        </ol>
                     </li>
                     </ol>
                  </li>
               </ol>
               </li>
            </ol>
            </li>
         </ol>

         <div id="lang-option-js" style="display:none">
option_en.js and option_fr.js files:
         <pre class="brush: js;">
/* This file will be used by the option */
known_sentences.concat({
   'Hello World':'Hello World plugin',
   'my_option':'My option',
};
         </pre>
         <pre class="brush: js;">
/* This file will be used by the option */
known_sentences.concat({
   'Hello World':'Plugin Hello World',
   'my_option':'Mon option',
};
         </pre>
         </div>
         <div id="lang-js" style="display:none">
en.js file, fr.js file would contain the same content but translated:
         <pre class="brush: js;">
/* This file will be used by your scripts */
known_sentences.concat({
   't1':'Translation 1',
   't2':'{0} done / {1} total',
   't3':function(args) {
      return 'Translation 3: ' + args[0];
   },
};
         </pre>
      
         To translate in the adminstration:
         <pre class="brush: js;">
// Elements with a class="translate" will be translated automatically after the page load.
// However if you add elements later on (e.g., after receiving an AJAX response), you must
// inform the gallery that it must perform new translations. This can be done in a single line:
$(".translate").translate();

// If you want to use arguments in your translations, you have to put the translated text directly
// in your templates as follows:
$("...").append(... + t('t2', [ 0, 1 ]);
$("...").append(... + t('t3', [ 0, 1, 2, 3, ... ]);
         </pre>
         </div>

         <h3>Information popups in the administration</h3>
        Another great feature of the administration is the information system. You can either inform the user of a success, warn him or report an error. Note that if an AJAX call fails, an error with detailed information will show up automatically.

         <pre class="brush: js;">
function inform(tag, type, add, params, div);

// E.g., the following will show a "success" div on top of the page containing
// the translation of t2 (e.g., "done 0 / 1" here, click on the "en.js" file in the previous subsection to know why).
// true is used to say that you want to add the div (false will remove the div)
// By default the div show on top of the page but you can specify the container div using the div parameter
inform('t2', 'success', true, [0, 1]);
         </pre>

        <h2>Complete examples</h2>

        The gpx plugin is a good example of a content plugin. The face plugin is a good example of an administration plugin. Both plugins are shipped with the galery.


               </div>
      <script type="text/javascript">
        SyntaxHighlighter.all()
      </script>
   </body>
</html>
